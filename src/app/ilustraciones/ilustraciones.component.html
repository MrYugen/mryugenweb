<div [class.dark]="isDarkMode" class="min-h-screen bg-bg text-text transition-colors duration-300">

    <app-navbar class="hidden md:block fixed w-full z-40 top-0" [isDarkMode]="isDarkMode"
        (toggleTheme)="toggleTheme()"></app-navbar>
    <app-mobile-navbar class="block md:hidden fixed w-full z-40 top-0" [isDarkMode]="isDarkMode"
        (toggleTheme)="toggleTheme()"></app-mobile-navbar>

    <app-hero [isDarkMode]="isDarkMode" title="Ilustraciones" subtitle="Colección de arte digital & procesos creativos"
        [showCTA]="false" logoLight='assets/images/logo-hero-dark.svg'
        bgImageLight="/assets/images/illustrations-hero-light.jpg"
        bgImageDark="/assets/images/illustrations-hero-dark.jpg" [overlayOpacity]="0.3" [logoAlt]="'Mr. Yugen Art'">
    </app-hero>

    <main class="max-w-[1600px] mx-auto px-4 md:px-8 py-20">
        <div class="columns-1 md:columns-2 lg:columns-3 xl:columns-4 gap-8 space-y-8">

            <div *ngFor="let illu of illustrations; let i = index" class="break-inside-avoid mb-8">
                <div class="group relative cursor-pointer illu-card" (click)="openModal(i)">

                    <div
                        class="overflow-hidden rounded-lg bg-gray-200 dark:bg-gray-800 aspect-auto shadow-sm transition-shadow duration-300 group-hover:shadow-2xl">
                        <img [src]="illu.image" [alt]="illu.title" class="w-full h-auto object-cover fade-in-image"
                            (load)="onImageLoad($event)" loading="lazy" />

                        <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors duration-300">
                        </div>
                    </div>

                    <div
                        class="mt-3 flex justify-between items-center opacity-70 group-hover:opacity-100 transition-opacity duration-300 px-1">
                        <h3 class="text-sm font-medium tracking-wide uppercase">{{ illu.title }}</h3>
                        <span class="text-xs text-cta">+ Ver proceso</span>
                    </div>

                </div>
            </div>

        </div>
    </main>

    <div *ngIf="modalOpen" class="lightbox-container fixed inset-0 z-[100] flex flex-col justify-between animate-fadeIn"
        (click)="closeModal()">

        <div class="w-full p-6 flex justify-between items-start z-50 pointer-events-none">
            <div class="pointer-events-auto">
            </div>
            <button
                class="pointer-events-auto text-white/50 hover:text-white transition-colors transform hover:rotate-90 duration-300 p-2"
                (click)="closeModal()" aria-label="Cerrar">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>

        <div class="flex-1 flex items-center justify-between relative px-2 md:px-8 h-full overflow-hidden"
            (click)="$event.stopPropagation()">

            <button class="nav-arrow hidden md:block z-50 rounded-full hover:bg-white/5" (click)="prevIllustration()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M15 18l-6-6 6-6" />
                </svg>
            </button>

            <div class="relative w-full h-full flex items-center justify-center overflow-hidden" (click)="toggleZoom()"
                [style.cursor]="zoomed ? (isDragging ? 'grabbing' : 'grab') : 'zoom-in'">

                <img [src]="illustrations[activeIndex].process[currentStep]" [alt]="illustrations[activeIndex].title"
                    class="modal-img shadow-2xl" [class.zoomed]="zoomed"
                    [ngStyle]="zoomed ? { 'transform': 'scale(2) translate(' + imgOffset.x + 'px,' + imgOffset.y + 'px)' } : null"
                    (mousedown)="startDrag($event)" (mousemove)="onDrag($event)" (mouseup)="endDrag()"
                    (mouseleave)="endDrag()" (touchstart)="onTouchStartImage($event)"
                    (touchmove)="onTouchMoveImage($event)" (touchend)="onTouchEndImage()" draggable="false" />
            </div>

            <button class="nav-arrow hidden md:block z-50 rounded-full hover:bg-white/5" (click)="nextIllustration()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M9 18l6-6-6-6" />
                </svg>
            </button>

        </div>

        <div class="w-full bg-black/40 backdrop-blur-md border-t border-white/10 p-4 md:p-6 z-50"
            (click)="$event.stopPropagation()">
            <div class="max-w-4xl mx-auto flex flex-col md:flex-row items-center justify-between gap-6">

                <div class="text-center md:text-left min-w-[150px]">
                    <h2 class="text-white text-xl font-bold tracking-tight">{{ illustrations[activeIndex].title }}</h2>
                    <p class="text-white/40 text-xs uppercase tracking-widest mt-1">Ilustración Digital</p>
                </div>

                <div class="flex-1 w-full md:w-auto px-4">
                    <div class="flex justify-between text-[10px] uppercase tracking-widest text-white/40 mb-3 px-1">
                        <span>Boceto</span>
                        <span>Final</span>
                    </div>

                    <div class="timeline-track relative">
                        <div class="timeline-progress rounded-full"
                            [style.width.%]="(currentStep / (illustrations[activeIndex].process.length - 1)) * 100">
                        </div>

                        <button *ngFor="let stepImg of illustrations[activeIndex].process; let s = index"
                            class="timeline-dot" [class.active]="s === currentStep"
                            [style.left.%]="(s / (illustrations[activeIndex].process.length - 1)) * 100"
                            (click)="setStep(s)" [attr.aria-label]="'Ver paso ' + (s + 1)">
                            <span class="timeline-label">
                                {{ getStepLabel(s) }}
                            </span>
                        </button>
                    </div>
                </div>

                <div class="flex gap-4 min-w-[150px] justify-center md:justify-end">
                    <button class="text-white/60 hover:text-cta transition text-xs flex items-center gap-2"
                        (click)="toggleZoom()">
                        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"
                            viewBox="0 0 24 24">
                            <circle cx="11" cy="11" r="8" />
                            <line x1="21" y1="21" x2="16.65" y2="16.65" />
                            <line x1="11" y1="8" x2="11" y2="14" />
                            <line x1="8" y1="11" x2="14" y2="11" />
                        </svg>
                        Zoom
                    </button>
                </div>

            </div>
        </div>

    </div>

    <app-footer></app-footer>
    <app-scroll-to-top></app-scroll-to-top>
</div>